var url="https://codingninjas.in/api/v3/mentors/get_ta_resolved_doubts",token="",four_star=!0,rating_reason=!1;function sortTable(e){var t,a,r,n,o,s,i,l,d=0;for(t=document.getElementById("myTable"),r=!0,l="asc";r;){for(r=!1,a=t.rows,n=1;n<a.length-1;n++)if(i=!1,o=a[n].getElementsByTagName("td")[e],s=a[n+1].getElementsByTagName("td")[e],"asc"==l){if(o.innerHTML.toLowerCase()>s.innerHTML.toLowerCase()){i=!0;break}}else if("desc"==l&&o.innerHTML.toLowerCase()<s.innerHTML.toLowerCase()){i=!0;break}i?(a[n].parentNode.insertBefore(a[n+1],a[n]),r=!0,d++):0==d&&"asc"==l&&(l="desc",r=!0)}}var generateStats=function(e){var t='<table class="table table-bordered" id="statsTable">';t+="<tr><th>Rating</th><th>Count</th></tr>";let a=0;Object.keys(e).forEach(function(r){t+='<tr class="rating-'+r+'">',t+="null"==r?"<td><b>Unrated<b></td>":"<td><b>"+r+"<b></td>",t+="<td>"+e[r]+"</td>",t+="</tr>",a+=e[r]}),t+='<tr class="total">',t+="<td><b>Total<b></td>",t+="<td><b>"+a+"</b></td>",t+="</tr>",t+="</table>",$("div#statsTable").html(t)},makeTable=function(){token.length<5&&(token=localStorage.getItem("token")),$.ajax({url:url,type:"GET",dataType:"json",headers:{"content-type":"application/x-www-form-urlencoded",Authorization:"Token "+token},success:function(e){if($("#options")[0].style.visibility="visible",e.data){var t=e.data.doubts,a='<table class="table table-bordered" id="myTable">';a+="<tr>",a+='<th onclick="sortTable(0)">Sno.</th>';var r=1;$.each(t[0],function(e,t){if(rating_reason){if("email"==e||"title"==e||"resolved_time"==e)return}else if("email"==e||"title"==e||"resolved_time"==e||"rating_reason"==e)return;a+='<th onclick="sortTable('+r+')">'+e+"</th>",r++}),a+="</tr>";var n=1;stars={1:0,2:0,3:0,4:0,5:0,null:0},$.each(t,function(e,t){if(stars[t.rating]++,four_star){if(5==t.rating)return}else if(t.rating>=4)return;a+='<tr class="rating-'+t.rating+'">',a+="<td>"+n+"</td>",n++,$.each(t,function(e,r){if(rating_reason){if("email"==e||"title"==e||"resolved_time"==e)return}else if("email"==e||"title"==e||"resolved_time"==e||"rating_reason"==e)return;"name"==e&&t.rating<4?a+="<td><b>"+r+"</b></td>":a+="<td>"+r+"</td>"}),a+="</tr>"}),a+="</table>",$("div#displayTable").html(a),generateStats(stars)}else{var o='<h2 id="expiredToken">'+e.error.message+"</h2>";$("div#displayTable").html(o)}}})};$(document).ready(makeTable),$(document).ready(function(){$("form").submit(e=>{e.preventDefault(),token=e.target[0].value,localStorage.setItem("token",token),makeTable()})}),$(document).ready(function(){$("#four-stars").on("change",function(e){e.preventDefault(),!1===$("#four-stars").prop("checked")?(four_star=!1,$("#rating-reason").bootstrapToggle("enable")):(four_star=!0,rating_reason=!1,$("#rating-reason").bootstrapToggle("off"),$("#rating-reason").bootstrapToggle("disable")),makeTable()}),$("#rating-reason").on("change",function(e){e.preventDefault(),rating_reason=$("#rating-reason").prop("checked"),makeTable()})});
