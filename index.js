var url="https://api.codingninjas.com/api/v3/mentors/resolved_doubts?limit=",get_offset_url="https://api.codingninjas.com/api/v3/mentors/taships",token="",four_star=!1,rating_reason=!1;function sortTable(e){var t,a,r,n,o,s,i,l,u=0;for(t=document.getElementById("myTable"),r=!0,l="asc";r;){for(r=!1,a=t.rows,n=1;n<a.length-1;n++)if(i=!1,o=a[n].getElementsByTagName("td")[e],s=a[n+1].getElementsByTagName("td")[e],"asc"==l){if(o.innerHTML.toLowerCase()>s.innerHTML.toLowerCase()){i=!0;break}}else if("desc"==l&&o.innerHTML.toLowerCase()<s.innerHTML.toLowerCase()){i=!0;break}i?(a[n].parentNode.insertBefore(a[n+1],a[n]),r=!0,u++):0==u&&"asc"==l&&(l="desc",r=!0)}}var generateStats=function(e,t){let a=0;for(i in e)a+=e[i];e.null+=t-a;var r='<table class="table table-bordered" id="statsTable">';r+="<tr><th>Rating</th><th>Count</th></tr>";let n=0;Object.keys(e).forEach(function(t){r+='<tr class="rating-'+t+'">',r+="null"==t?"<td><b>Unrated<b></td>":"<td><b>"+t+"<b></td>",r+="<td>"+e[t]+"</td>",r+="</tr>",n+=e[t]}),r+='<tr class="total">',r+="<td><b>Total<b></td>",r+="<td><b>"+t+"</b></td>",r+="</tr>",r+="</table>",$("div#statsTable").html(r)},makeTable=function(){$.ajax({url:get_offset_url,type:"GET",dataType:"json",headers:{"content-type":"application/x-www-form-urlencoded",Authorization:"Token "+token},success:function(e){if(e.data){var t=e.data.taship_stats[1].count;makeTableWithOffset(t)}else{var a='<h2 id="expiredToken">'+e.error.message+"</h2>";$("div#displayTable").html(a)}}})},makeTableWithOffset=function(e){token.length<5&&(token=localStorage.getItem("token")),$.ajax({url:url+e,type:"GET",dataType:"json",headers:{"content-type":"application/x-www-form-urlencoded",Authorization:"Token "+token},success:function(t){if($("#options")[0].style.visibility="visible",t.data){var a=t.data.doubts,r='<table class="table table-bordered" id="myTable">';r+="<tr>",r+='<th onclick="sortTable(0)">Sno.</th>';var n=1;$.each(a[0],function(e,t){if(rating_reason){if("user_name"!=e&&"user_rating"!=e&&"rating_reason"!=e)return}else if("user_name"!=e&&"user_rating"!=e)return;r+='<th onclick="sortTable('+n+')">'+e+"</th>",n++}),r+="</tr>";var o=1;stars={1:0,2:0,3:0,4:0,5:0,null:0},$.each(a,function(e,t){if("Machine Learning Course"!==!t.course_module_name){if(stars[t.user_rating]++,four_star){if(5==t.user_rating)return}else if(t.user_rating>=4)return;r+='<tr class="rating-'+t.user_rating+'">',r+="<td>"+o+"</td>",o++,$.each(t,function(e,a){if(rating_reason){if("user_name"!=e&&"user_rating"!=e&&"rating_reason"!=e)return}else if("user_name"!=e&&"user_rating"!=e)return;"user_name"==e&&t.user_rating<4?r+="<td><b>"+a+"</b></td>":r+="<td>"+a+"</td>"}),r+="</tr>"}}),r+="</table>",$("div#displayTable").html(r),generateStats(stars,e)}else{var s='<h2 id="expiredToken">'+t.error.message+"</h2>";$("div#displayTable").html(s)}}})};$(document).ready(makeTable),$(document).ready(function(){$("form").submit(e=>{e.preventDefault(),token=e.target[0].value,localStorage.setItem("token",token),makeTable()})}),$(document).ready(function(){$("#four-stars").on("change",function(e){e.preventDefault(),!1===$("#four-stars").prop("checked")?(four_star=!1,$("#rating-reason").bootstrapToggle("enable")):(four_star=!0,rating_reason=!1,$("#rating-reason").bootstrapToggle("off"),$("#rating-reason").bootstrapToggle("disable")),makeTable()}),$("#rating-reason").on("change",function(e){e.preventDefault(),rating_reason=$("#rating-reason").prop("checked"),makeTable()})});
